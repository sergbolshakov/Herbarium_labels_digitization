# Herbarium Labels Data Transcription

## Обзор

Приложение разработано для облегчения процесса оцифровки гербарных образцов на этапе
извлечения данных с этикеток.

Приложение позволяет 
- последовательно или выборочно просматривать изображения гербарных листов или конвертов
- заполнять с нуля, или проверять и редактировать данные об образцах с этикеток
- записывать все новые или изменённые данные в файл таблицы данных, связывая запись о образце с названием файла изображения образца

## Как работает

1. Выбор директории и файлов изображений:
- Пользователь с помощью кнопки «Выбрать папку с изображениями» выбирает на диске или файловом сервере директорию, в которой хранятся файлы изображений гербарных образцов
- В директории отфильтровываются стандартные форматы изображений
- Выбор директории с изображениями запускает остальной интерфейс приложения
- Формируется список файлов и отображается в той же панели слева
- К списку файлов добавляется форма для поиска файлов по названию

2. Просмотр изображений:
- При начальной запуске приложения первый файл в списке автоматически открывается в большой панели посередине
- Последовательный просмотр файлов осуществляется кнопка «Вперед» и «Назад»
- Выбором или поиском в списке файлов слева можно открыть любой нужный файл

3. Просмотр и редактирование данных:
- Открытие файла изображения синхронизировано с отображением соответствующих названию файла данных из файла таблицы `data.tsv` в корне проекта
- Каждая строка данных отображается в вертикальном виде для удобства просмотра
- Если файл с данными уже с заполненными данными, то показываются только непустые поля
- Режим редактирования позволяет вносить с нуля или редактировать нужные поля данных
- При сохранении изменений обязательным является заполнение поля `catalogNumber`, и автоматически заполняется поле `imageFile`, которое связывает строку данных с файлом изображения
- Сохранение измененений каждый раз перезаписывает файл `data.tsv`
- Все изменения сразу отображаются в панели просмотра данных

## Как установить и запустить

Требуется наличие установленных [R](https://cran.r-project.org/) и [RStudio](https://posit.co/download/rstudio-desktop/).

Для установки и работы приложения требуется установить необходимые пакеты:
```r
install.packages(
  c(
    "shiny",
    "bslib",
    "shinyjs",
    "shinyFiles",
    "fs",
    "DT",
    "tidyverse",
    "rlang"
  )
)
```

Репозиторий с кодом приложения может быть скачан как ZIP-архив или клонирован на диск средствами Git:
```
git clone https://github.com/sergbolshakov/Herbarium_labels_digitization.git
```

Затем нужно открыть папку с кодом приложения как проект в RStudio.  
Для запуска приложения откройте файл `app.R` и нажмите кнопку «Run App» в правом верхнем углу.  
Или вызовите команду `shiny::runApp()` в консоли RStudio.

## Функционал, который требуется реализовать

1. Установка конфигурации. Использование файла или диалога настройки, в котором можно было бы указать:
- адреса директорий на файловом сервере института, в которых хранятся гербарные изображения
- адрес и название файла с данными
- имя оператора, который будет проводить внесение и редактирование данных
- список полей данных, которые будут заполняться

2. ~~Автоматическое переименование файлов изображений. Файлы изображений обычно имеют названия вида биномиальное научное название (папки или полки с образцами) + автоинкремент (автоматически генерируемое камерой или сканером название). Для более удобного управления файлами в отрыве от базы данных удобно иметь вместо стандартного автоинкремента гербарный номер образца. В случае, когда для одного образца имеется несколько изображений, переименование должно добавлять числовой суффикс.~~

3. Автоматическое встраивание данных в [XMP](https://en.wikipedia.org/wiki/Extensible_Metadata_Platform) (пользовательские метаданные изображения) файла изображения.

## Планы по дальнейшему развитию

Первичная оцифровка данных с изображения подразумевает дословное внесение оригинального текста этикетки (verbatim data). Дальнейшая работа подразумевает автоматизированное добавление к каждому дословному текстовому полю нормализованных проверенных данных с валидацией из справочников. Оригинальные текстовые поля сортируются и кластеризуются, и в соответствующие им нормализованные поля массово заполняются данные из списков подстановки. Для такой работы должны запускаться отдельные режимы — проверка и заполнение коллекторов, дат, определений, географической информации, эксиккат.